(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["f87680b0a1088b4e39263723b59719d2"],{aLUo:function(e,t,i){"use strict";i("pNMO");i("4Brf");i("ma9I");i("TeQF");i("yXV3");i("4mDm");i("+2oP");i("T63A");i("3KgV");i("5DmW");i("07d7");i("FZtP");i("3bBZ");var a=E(i("+a4J"));var y=E(i("RPZL"));var r=E(i("lTCR"));var c=E(i("nSHN"));var u=i("o1mU");var n=E(i("Fumg"));var p=E(i("x+rD"));var s=v(i("uchz"));var o=E(i("ZpD3"));var S=i("LrfN");var h=v(i("t1sY"));var l=i("O6wL");var f=v(i("4PhQ"));var d=E(i("mXPZ"));var P=E(i("Jayu"));var g=E(i("Q8Wn"));function v(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var i in e){if(Object.prototype.hasOwnProperty.call(e,i)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};if(a.get||a.set){Object.defineProperty(t,i,a)}else{t[i]=e[i]}}}}t.default=e;return t}}function E(e){return e&&e.__esModule?e:{default:e}}function A(e,t){if(e==null)return{};var i=m(e,t);var a,r;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++){a=n[r];if(t.indexOf(a)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,a))continue;i[a]=e[a]}}return i}function m(e,t){if(e==null)return{};var i={};var a=Object.keys(e);var r,n;for(n=0;n<a.length;n++){r=a[n];if(t.indexOf(r)>=0)continue;i[r]=e[r]}return i}function T(){var t=I(["\n    mutation updateUserVideoProgress($input: UserVideoProgressInput!) {\n        updateUserVideoProgress(videoProgressUpdate: $input) {\n            videoItemProgress {\n                content {\n                    id\n                    progressKey\n                    ... on Video {\n                        downloadUrls\n                    }\n                }\n                lastSecondWatched\n                secondsWatched\n                lastWatched\n                points\n                started\n                completed\n            }\n            actionResults {\n                pointsEarned {\n                    points\n                }\n                tutorialNodeProgress {\n                    contentId\n                    progress\n                }\n                userProfile {\n                    countVideosCompleted\n                    points\n                    streakLastExtended\n                    streakLastLength\n                    streakLength\n                    countBrandNewNotifications\n                }\n                notificationsAdded {\n                    badges\n                    avatarParts\n                    readable\n                    urgent\n                    toast\n                    continueUrl\n                }\n                ... on VideoActionResults {\n                    currentTask {\n                        content {\n                            id\n                        }\n                        pointBounty\n                    }\n                }\n            }\n            error {\n                code\n                debugMessage\n            }\n        }\n    }\n"]);T=function e(){return t};return t}function I(e,t){if(!t){t=e.slice(0)}return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function b(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};var a=Object.keys(i);if(typeof Object.getOwnPropertySymbols==="function"){a=a.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))}a.forEach(function(e){L(t,e,i[e])})}return t}function L(e,t,i){if(t in e){Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true})}else{e[t]=i}return e}function N(e,t){return C(e)||O(e,t)||V()}function V(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function O(e,t){var i=[];var a=true;var r=false;var n=undefined;try{for(var s=e[Symbol.iterator](),o;!(a=(o=s.next()).done);a=true){i.push(o.value);if(t&&i.length===t)break}}catch(e){r=true;n=e}finally{try{if(!a&&s["return"]!=null)s["return"]()}finally{if(r)throw n}}return i}function C(e){if(Array.isArray(e))return e}var D=function e(t){return Object.entries(t).filter(function(e){var t=N(e,2),i=t[0],a=t[1];return a!==undefined}).reduce(function(e,t){var i=N(t,2),a=i[0],r=i[1];return b({},e,L({},a,r))},{})};var w=(0,r.default)(T());var k=a.default.Model.extend({MIN_SECONDS_BETWEEN_SAVES:30,MIN_PERCENT_BETWEEN_SAVES:.1,MIN_SECONDS_BETWEEN_SAVES_PHANTOM:60,MIN_PERCENT_BETWEEN_SAVES_PHANTOM:.25,SANITY_CHECK_POLL_INTERVAL:1e4,REQUIRED_PERCENT_FOR_FULL_POINTS:.9,defaults:{points:0,pointsSaved:0,possiblePoints:750,videoKey:"",youtubeId:"0",playbackSpeedAvailable:false,playbackRate:1,playerState:S.VideoPlayerState.UNSTARTED,numPolls:0,playerStateHistory:"",showOptions:true,showPoints:true,showInfo:true,showShare:true,showEditCaptions:false,transcriptAvailable:false,topicID:undefined,useCaptionsDetectionFallback:true,captionsLocale:"",hasPlayed:false,getCurrentTimeIsDefinitelyWorking:false,userHasHitPauseOnThisVideo:false,_videoLogState:{secondsWatchedSinceSave:0,percentLastSaved:0,lastPollTime:new Date}},player:null,initialize:function e(t){var i=this;var a=[];for(var r in this){if(typeof this[r]==="function"){a.push(r)}}a.forEach(function(e){return i[e]=i[e].bind(i)});if(d.default.isLoggedIn){this.set({secondsBetweenSaves:this.MIN_SECONDS_BETWEEN_SAVES,percentBetweenSaves:this.MIN_PERCENT_BETWEEN_SAVES,maxConsecutiveFailures:100})}else{this.set({secondsBetweenSaves:this.MIN_SECONDS_BETWEEN_SAVES_PHANTOM,percentBetweenSaves:this.MIN_PERCENT_BETWEEN_SAVES_PHANTOM,maxConsecutiveFailures:3})}this.maybeShowEditCaptionsButton(t.slug,t.translatedYoutubeLang);this.consecutiveFailures=0;this.listenToVideoStart();var n=(this.get("thumbnailUrls")||{}).filtered||"";this.set("thumbnailUrl",n)},listenToVideoStart:function e(){var a=this;var t=function e(t,i){if(i===S.VideoPlayerState.PLAYING){p.default.sendEventToGA("videoStart",{videoSlug:a.get("nodeSlug")});a.off("change:playerState",e)}};this.on("change:playerState",t)},maybeShowEditCaptionsButton:function e(t,i){var a=n.default.getLocale();if(a!=="en"&&t){var r=a===i?1:0;this.set({showEditCaptions:true,fanCaptionLink:"/translate/videos/".concat(t,"/subtitle")+"?lang=".concat(i,"&dub=").concat(r)})}else{this.set("showEditCaptions",false)}},markConversion:function e(t){var i=this.get("markConversion");if(i){i(t)}else{o.default.markConversion(t.id,t.extra,{activity:l.enums.Activity.WATCHING})}},_getUpdatedSecondsWatched:function e(t,i,a,r){var n=a.secondsWatchedSinceSave,s=a.lastSecondWatched;if(i===S.VideoPlayerState.PLAYING&&s===undefined){s=this.getVideoPosition(0)}else if(t===S.VideoPlayerState.PLAYING){var o=(r-a.lastPollTime)/1e3;var l=o*this.get("playbackRate");if(!n){n=l}else{n+=l}s+=l}return{secondsWatchedSinceSave:n,lastSecondWatched:s}},_updatePlayerStateHistory:function e(t,i,a,r,n){var s=this.get("playerStateHistory");s+=this.get("numPolls")+t;if(a!==undefined){s+="_".concat(i,"-").concat(a)}else{s+="_".concat(i)}s+="_".concat(this.get("playbackRate"));if(this.player&&this.player.getPlayerState){s+="_".concat(this.player.getPlayerState())}if(r!==undefined||n!==undefined){s+="_".concat(r||"0");s+="_".concat(n||"0")}s+=";";this.set("playerStateHistory",s);return s},_handleVideoLogPoll:function e(t,i,a){var r=this;var n=new Date;var s=this.get("_videoLogState");var o=this._getUpdatedSecondsWatched(t,i,s,n),l=o.lastSecondWatched;var d=this.getDuration();if(a===true&&t===S.VideoPlayerState.PLAYING&&d!==0&&l>d+1){this.setPlayerState(S.VideoPlayerState.ENDED);p.default.sendNonInteractionEventToGA("event","Diagnostics","video-player-state-reset");return}if(t===S.VideoPlayerState.PLAYING){var c=this.get("readableId")||this.get("slug");var u={type:"UPDATE_LAST_SECOND_WATCHED",readableId:c,lastSecondWatched:l};P.default.dispatch(u)}this.set("numPolls",this.get("numPolls")+1);var h=i===S.VideoPlayerState.PLAYING;var f=i!==undefined&&i!==S.VideoPlayerState.PLAYING;if(h){this.set("autoSaveTimer",setInterval(function(){return r._handleVideoLogPoll(r.get("playerState"),undefined,true)},this.SANITY_CHECK_POLL_INTERVAL))}else if(f){this.set("autoSaveTimer",clearInterval(this.get("autoSaveTimer")))}if(!h&&n-s.lastPollTime>2.5*this.SANITY_CHECK_POLL_INTERVAL){this.set("_videoLogState",y.default.assoc(s,"lastPollTime",n));this._updatePlayerStateHistory("a",t,i);return}var g=y.default.assign(s,this._getUpdatedSecondsWatched(t,i,s,n),this._flushVideoLogStateAsNecessary(t,i,s,n),{lastPollTime:n});var v=Math.max(this.getVideoPosition(g.lastSecondWatched),g.secondsWatchedSinceSave);g=y.default.assign(g,{lastSecondWatched:v});this.set("_videoLogState",g);this._updatePointsEstimate(g.secondsWatchedSinceSave)},_flushVideoLogStateAsNecessary:function e(t,i,a,r){var n=this;var s=i===S.VideoPlayerState.PLAYING;var o=i!==undefined&&i!==S.VideoPlayerState.PLAYING;var l=this._getUpdatedSecondsWatched(t,i,a,r),d=l.secondsWatchedSinceSave,c=l.lastSecondWatched;var u=s&&this.getVideoPosition(a.lastSecondWatched)<1;var h=t===S.VideoPlayerState.PLAYING&&o===true&&d>1;var f=i===S.VideoPlayerState.ENDED&&d>=1;var g=this._isAutoSaveIntervalExceeded(d);var v=t===S.VideoPlayerState.PLAYING&&a.percentLastSaved<this.REQUIRED_PERCENT_FOR_FULL_POINTS&&this.getCurrentPositionAsPercent(c)>=this.REQUIRED_PERCENT_FOR_FULL_POINTS;if(u||h||f||g||v){p.default.getGAReferrer().then(function(e){n._flushVideoLogState(d,c,t,i,e)});return{secondsWatchedSinceSave:0,percentLastSaved:this.getCurrentPositionAsPercent(c)}}this._updatePlayerStateHistory("b",t,i,d,c);return{}},_flushVideoLogState:function e(t,a,i,r,n){var s=this;var o=this;if(this.get("savingVideoLogState")){this._updatePlayerStateHistory("c",i,r,t,a);return}this.set("savingVideoLogState",true);if(!h.areCookiesEnabled()){f.default.log("Cookies seem to be disabled. Not logging progress.");this._updatePlayerStateHistory("d",i,r,t,a);return}if(this.consecutiveFailures>=this.get("maxConsecutiveFailures")){f.default.error("Not sending video log due to too many failures",f.Errors.Internal);this._updatePlayerStateHistory("e",i,r,t,a);return}this._updatePlayerStateHistory("",i,r,t,a);this.set("playerStateHistory","");var l=D({youtubeId:this.get("youtubeId"),secondsWatched:t||0,lastSecondWatched:a||0,durationSeconds:this.getDuration(),topicSlug:this.get("topicID"),userMissionId:this.get("userMissionId"),captionsLocale:this.captionsCurrentLanguage(),fallbackPlayer:this.get("playerType")==="html",clientDt:new Date,localTimezoneOffsetSeconds:-1*(new Date).getTimezoneOffset()*60,gaReferrer:n});if(this.videoTaskView){this.videoTaskView.model.recordWatch(a,t)}if(r!==S.VideoPlayerState.PAUSED){this.markConversion({id:"video_log_client",extra:l})}var d=function e(t){var i=t.data.updateUserVideoProgress;var a=s.get("completed");if(i&&!i.error&&i.videoItemProgress){var r=i.videoItemProgress.completed;if(!a&&r){return["UserAssignments"]}}return[]};(0,u.apolloMutate)(w,{variables:{input:l},module:"multithreaded",refetchQueries:d}).then(function(e){var t=e.data.updateUserVideoProgress;if(t.error){var i=t.error.code;if(i!=="CHEATING"){o._logFailedProgressUpdate(i,o.get("youtubeId"),a)}o.consecutiveFailures+=1}else if(t.videoItemProgress){o.consecutiveFailures=0;c.default.respondToGraphQLAction(t.actionResults);o._finishSave(t.videoItemProgress)}else{f.default.error("updateUserVideoProgress came back with both a null error and null videoItemProgress.",f.Errors.Internal)}}).catch(function(e){f.default.error("Failed to update user video progress",f.Errors.Internal,e);o.consecutiveFailures+=1}).then(function(){o.set("savingVideoLogState",false)})},_logFailedProgressUpdate:function e(t,i,a){f.default.error("Failed to update user video progress. Error returned from GraphQL mutation",f.Errors.Internal,null,{sentry:{fingerprint:["updateUserVideoProgress",t],extras:{errorCode:t,youtubeId:i,lastSecondWatched:"".concat(a),youtubeLanguage:g.default.languageYoutube}}})},captionsCurrentLanguage:function e(){var t=false;var i="";var a={};if(!this.get("useCaptionsDetectionFallback")){return this.get("captionsLocale")}if(this.player==null){f.default.log("No player, no captions");return i}try{t=t||this.player.getOptions("cc").length>0;a=this.player.getOption("cc","track")}catch(e){}if(!t){try{t=this.player.getOptions("captions").length>0;a=this.player.getOption("captions","track")}catch(e){}}if(t){if("languageCode"in a){i=a["languageCode"]}}return i},_finishSave:function e(t){this.set("pointsSaved",t.points);var i=t.points,a=A(t,["points"]);if(i<this.get("points")){this.set(a)}else{this.set(t)}try{this.set("downloadUrls",JSON.parse(t.content.downloadUrls))}catch(e){f.default.error("Failed to parse downloadUrls",f.Errors.Internal,e)}if(t.completed){s.trackSingleEvent("Video Complete",this.getAnalyticsParameters())}var r={type:"UPDATE_STATUS",status:t.completed?"complete":"started",progressKey:t.content.progressKey};P.default.dispatch(r)},getAnalyticsParameters:function e(){return{"Video ID":this.get("videoKey")||this.get("youtubeId"),"Video Title":this.get("title"),"Video Topic ID":this.get("topicID")}},getVideoPosition:function e(t,i){if(!this.player||!this.player.getCurrentTime){return 0}if(this.player.getCurrentTime()>0&&!i){this.set("getCurrentTimeIsDefinitelyWorking",true)}if(this.get("getCurrentTimeIsDefinitelyWorking")){return this.player.getCurrentTime()||0}if(this.get("userHasHitPauseOnThisVideo")){return 0}return t||0},_updatePointsEstimate:function e(t){var i=this.getDuration();if(i===0){return}var a=Math.min(1,t/i);var r=a+this.get("pointsSaved")/this.get("possiblePoints");if(r>this.REQUIRED_PERCENT_FOR_FULL_POINTS){r=1}var n=Math.floor(this.get("possiblePoints")*r);if(n<this.get("points")){return}this.set({points:n})},_isAutoSaveIntervalExceeded:function e(t){var i=this.getDuration()*this.get("percentBetweenSaves");var a=Math.min(i,this.get("secondsBetweenSaves"));return t>=a},setPlaybackRate:function e(t){this._handleVideoLogPoll(this.get("playerState"));this.set("playbackRate",t)},getCurrentPositionAsPercent:function e(t){var i=this.getDuration();if(i===0){return 0}return Math.min(1,this.getVideoPosition(t)/i)},getDuration:function e(){var t=this.player&&this.player.getDuration&&this.player.getDuration()||this.get("duration")||0;return Math.max(0,Math.floor(t))},setInitialPlayerState:function e(t,i){if(i!=null){this.setPlaybackRate(i)}if(t===S.VideoPlayerState.PLAYING){var a=this.getVideoPosition(0);this.set("_videoLogState",y.default.assign(this.get("_videoLogState"),{secondsWatchedSinceSave:a,lastSecondWatched:a}))}this.setPlayerState(t)},setPlayerState:function e(t){this._handleVideoLogPoll(this.get("playerState"),t);var i=this.get("playerState");this.set({playerState:t});if(t===S.VideoPlayerState.UNSTARTED){this.set({userHasHitPauseOnThisVideo:false})}else if(t===S.VideoPlayerState.PAUSED){this.set({userHasHitPauseOnThisVideo:true})}if(i!==S.VideoPlayerState.PLAYING&&t===S.VideoPlayerState.PLAYING){if(!this.get("hasPlayed")){this.markConversion({id:"video_started_in_pageview",extra:{content_id:this.attributes.id,slug:this.attributes.nodeSlug}});this.set("hasPlayed",true)}}this._logAnalyticsActivity(t);this._logAnalyticsPlayPercent()},_logAnalyticsActivity:function e(t){if(t===S.VideoPlayerState.ENDED){if(this.analyticsActivity){this.analyticsActivity.parameters["Percent (end)"]=this.get("_videoLogState").percentLastSaved;s.trackActivityEnd(this.analyticsActivity);this.analyticsActivity=null}}else if(t===S.VideoPlayerState.PAUSED){if(this.analyticsActivity){this.analyticsActivity.parameters["Percent (end)"]=this.get("_videoLogState").percentLastSaved;s.trackActivityEnd(this.analyticsActivity);this.analyticsActivity=null}}else if(t===S.VideoPlayerState.PLAYING){if(!this.analyticsActivity){var i=this.getAnalyticsParameters();i["Percent (begin)"]=this.get("_videoLogState").percentLastSaved;this.analyticsActivity=s.trackActivityBegin("Video Play",i)}}},_logAnalyticsPlayPercent:function e(){if(this.analyticsPercentTimer){window.clearInterval(this.analyticsPercentTimer)}if(this.get("playerState")!==S.VideoPlayerState.PLAYING){return}if(!this.analyticsTrackedPercent){this.analyticsTrackedPercent={}}var t=Math.floor(this.getCurrentPositionAsPercent(0)*100);if(t>0&&t%10===0&&!this.analyticsTrackedPercent[t]){this.analyticsTrackedPercent[t]=true;s.trackSingleEvent("Video Play Progress -"+t+"%",this.getAnalyticsParameters())}this.analyticsPercentTimer=window.setInterval(this._logAnalyticsPlayPercent,1e3)}});k.UPDATE_USER_VIDEO_PROGRESS_MUTATION=w;e.exports=k}}]);
//# sourceMappingURL=../../sourcemaps/en/f87680b0a1088b4e39263723b59719d2.edc364d15d7149ea6b31.js.map